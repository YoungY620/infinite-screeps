# 循环运行提示词

> 用于在同一个 Session 内反复调用 AI，实现持续监控

---

## 🔄 单次迭代提示词

```
执行一次游戏循环：

1. 检查游戏状态（Controller Level, Creeps, 能量, 建筑）
2. 侦查周围房间（检测威胁）
3. 评估是否需要采取行动
4. 如果需要：修改代码/调整策略
5. 报告状态摘要

如果一切正常且无需干预，回复 "✅ 稳定运行" 并等待下一次调用。
```

---

## ⏰ 定时检查提示词（推荐）

```
定时检查（每 5 分钟）：

1. 获取游戏状态
2. 侦查周围房间
3. 检查异常情况：
   - 敌人入侵？
   - Creep 数量异常？
   - CPU 超限？
   - 建筑受损？
   
如果发现异常：详细分析并采取行动
如果一切正常：输出简短状态报告

状态报告格式：
[时间] Level X | Creeps: N | CPU: X.X | 威胁: 无/低/中/高
```

---

## 🚨 紧急响应提示词

```
紧急检查：

检测到可能的异常，立即：
1. 获取完整游戏状态
2. 扫描敌人
3. 检查防御状态
4. 如果有威胁：
   - 评估威胁等级
   - 决定是否激活 Safe Mode
   - 修改防御代码
5. 记录事件到日志
```

---

## 📋 完整循环提示词（详细版）

```
执行完整的游戏管理循环：

## 第一阶段：信息收集
1. 调用 API 获取当前房间状态
2. 统计：Controller Level, Progress, Creeps, 能量, 建筑
3. 侦查周围 8 个房间
4. 检测敌对 Creep

## 第二阶段：分析评估
1. 与上次状态对比（Memory.stats）
2. 评估发展速度是否正常
3. 识别瓶颈（能量不足？Creep 不够？）
4. 评估威胁等级

## 第三阶段：决策
根据分析结果决定：
- 无需干预 → 输出状态报告
- 需要优化 → 修改代码参数
- 有威胁 → 加强防御
- 严重威胁 → 激活 Safe Mode

## 第四阶段：执行
1. 如果修改了代码，上传到服务器
2. 更新知识库
3. Git 提交

## 第五阶段：报告
输出格式化状态报告：
╔════════════════════════════════════════╗
║  Screeps 状态报告 - [时间]             ║
╠════════════════════════════════════════╣
║  Level: X (进度 XX%)                   ║
║  Creeps: N (H:x B:x U:x)               ║
║  CPU: X.X/20                           ║
║  威胁: 无/低/中/高                      ║
║  下次检查: 5 分钟后                     ║
╚════════════════════════════════════════╝
```

---

## 🤖 自动化脚本集成

### 方法 1：Shell 循环

```bash
#!/bin/bash
# auto_monitor.sh

INTERVAL=300  # 5 分钟

while true; do
    echo "$(date): 执行游戏检查..."
    
    # 这里调用 AI（需要根据实际 API 调整）
    # cursor-ai --prompt "执行一次游戏循环..."
    
    echo "等待 ${INTERVAL} 秒..."
    sleep $INTERVAL
done
```

### 方法 2：游戏内代码触发

```javascript
// 在 main.js 中添加警报触发
module.exports.loop = function() {
    // ... 正常逻辑 ...
    
    // 检测异常情况
    const enemies = room.find(FIND_HOSTILE_CREEPS);
    if (enemies.length > 0) {
        // 发送邮件通知（游戏内置功能）
        Game.notify('⚠️ 敌人入侵！数量: ' + enemies.length);
        Memory.alerts = Memory.alerts || [];
        Memory.alerts.push({
            time: Game.time,
            type: 'invasion',
            count: enemies.length
        });
    }
};
```

### 方法 3：轮询检查

```bash
#!/bin/bash
# poll_alerts.sh

while true; do
    # 检查游戏内是否有警报
    ALERTS=$(curl -s -H "X-Token: $TOKEN" \
        "https://screeps.com/api/user/memory?shard=shard3&path=alerts" \
        | python3 -c "import sys,json; d=json.load(sys.stdin); print(len(d.get('data','[]')))")
    
    if [ "$ALERTS" != "0" ] && [ "$ALERTS" != "" ]; then
        echo "检测到警报！启动 AI 响应..."
        # 调用 AI
    fi
    
    sleep 60
done
```

---

## 📊 状态报告模板

```
╔══════════════════════════════════════════════════════════════╗
║  🎮 Screeps 状态报告                                         ║
║  时间: 2026-01-07 12:00:00 | Game.time: XXXXXX              ║
╠══════════════════════════════════════════════════════════════╣
║  📊 殖民地状态                                               ║
║  ├─ Level: 2 → 3 (进度: 0.3%)                               ║
║  ├─ Creeps: 10 (H:4 B:3 U:3)                                ║
║  ├─ Extensions: 0/5 建造中                                   ║
║  └─ CPU: 8.5/20 (42%)                                       ║
╠══════════════════════════════════════════════════════════════╣
║  🛡️ 防御状态                                                 ║
║  ├─ Safe Mode: 激活中                                        ║
║  ├─ Safe Mode 储备: 1                                        ║
║  ├─ Tower: 0 ❌                                              ║
║  └─ 威胁等级: 🟢 无                                          ║
╠══════════════════════════════════════════════════════════════╣
║  🔍 侦查报告                                                 ║
║  ├─ 周围玩家: 2                                              ║
║  ├─ 最强邻居: Level 3 (E12S35)                               ║
║  └─ 活跃 Creep: 12 (来自 2 个玩家)                           ║
╠══════════════════════════════════════════════════════════════╣
║  📋 下一步行动                                               ║
║  └─ 继续升级，等待 Level 3 解锁 Tower                        ║
╚══════════════════════════════════════════════════════════════╝

状态: ✅ 稳定运行
下次检查: 5 分钟后
```

---

## 💡 最佳实践

1. **简洁优先** - 正常情况下输出简短报告
2. **异常详细** - 发现问题时输出详细分析
3. **避免空转** - 稳定时可以延长检查间隔
4. **保存 Token** - 不要每次都消耗大量 token 做重复检查
5. **渐进式响应** - 小问题小调整，大问题才做大改动

